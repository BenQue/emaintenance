# 17. UI设计系统

## 概述

E-Maintenance System的统一UI设计系统，基于shadcn/ui组件库和BizLink企业品牌标识。本文档定义了完整的设计规范、组件标准和实施指导。

## 设计原则

### 1. 品牌一致性
- 统一的BizLink品牌配色方案
- 标准化的Logo使用规范
- 一致的视觉层次和设计语言

### 2. 用户体验优先
- 直观的界面设计和交互模式
- 优化的工作流程和信息架构
- 响应式设计和移动端适配

### 3. 技术现代化
- 基于shadcn/ui标准组件库
- TypeScript严格类型支持
- 可维护和可扩展的代码结构

## 品牌设计系统

### 配色规范

**主品牌色调 - BizLink Blue**
```css
:root {
  /* BizLink 品牌主色调 */
  --bizlink-50: #E3F2FD;     /* 最浅蓝 */
  --bizlink-100: #BBDEFB;    /* 浅蓝 */
  --bizlink-200: #90CAF9;    /* 中浅蓝 */
  --bizlink-300: #64B5F6;    /* 中蓝 */
  --bizlink-400: #42A5F5;    /* 浅蓝色变体 */
  --bizlink-500: #1E88E5;    /* BizLink 标准蓝色 (主色) */
  --bizlink-600: #1976D2;    /* 中深蓝 */
  --bizlink-700: #1565C0;    /* 深蓝色变体 */
  --bizlink-800: #0D47A1;    /* 最深蓝色 */
  --bizlink-900: #0A3D62;    /* 极深蓝 */
}
```

**系统功能色调**
```css
:root {
  /* 功能色彩 */
  --success: #2E7D32;        /* 成功/完成状态 */
  --warning: #F57C00;        /* 警告/待处理 */
  --error: #C62828;          /* 错误/紧急状态 */
  --info: #0097A7;           /* 信息提示 */
  
  /* 中性色系 */
  --neutral-50: #FAFAFA;
  --neutral-100: #F5F5F5;
  --neutral-200: #EEEEEE;
  --neutral-300: #E0E0E0;
  --neutral-400: #BDBDBD;
  --neutral-500: #9E9E9E;
  --neutral-600: #757575;
  --neutral-700: #616161;
  --neutral-800: #424242;
  --neutral-900: #212121;
  
  /* 背景色系 */
  --background-primary: #FFFFFF;
  --background-secondary: #F8F9FA;
  --background-tertiary: #E3F2FD;
}
```

**Tailwind CSS配置**
```typescript
// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      colors: {
        bizlink: {
          50: '#E3F2FD',
          100: '#BBDEFB',
          200: '#90CAF9',
          300: '#64B5F6',
          400: '#42A5F5',
          500: '#1E88E5',    // 主色
          600: '#1976D2',
          700: '#1565C0',
          800: '#0D47A1',
          900: '#0A3D62',
        },
        functional: {
          success: '#2E7D32',
          warning: '#F57C00',
          error: '#C62828',
          info: '#0097A7',
        },
        // 兼容性别名
        primary: {
          50: '#E3F2FD',
          100: '#BBDEFB',
          500: '#1E88E5',
          600: '#1976D2',
          700: '#1565C0',
          900: '#0D47A1',
        }
      }
    }
  }
}
```

### Logo使用规范

**文件位置**: `/docs/Bizlink_Logo_RGB.png`

**使用场景和规格**:
- **导航栏Logo**: 左上角位置，高度32px，响应式调整
- **登录页面**: 居中展示，高度60px
- **移动端适配**: 最小高度24px，保持宽高比4.2:1
- **背景要求**: 白色或浅色背景确保对比度

**技术实现**:
```typescript
// components/ui/BizLinkLogo.tsx
import Image from 'next/image'

interface BizLinkLogoProps {
  height?: number
  className?: string
}

export const BizLinkLogo = ({ 
  height = 32, 
  className = '' 
}: BizLinkLogoProps) => (
  <Image
    src="/docs/Bizlink_Logo_RGB.png"
    alt="BizLink"
    height={height}
    width={height * 4.2} // 基于Logo宽高比
    className={className}
    priority
  />
)
```

## 组件系统架构

### shadcn/ui集成策略

**核心组件映射**:

| 功能类别 | 当前组件 | shadcn/ui组件 | 状态 |
|---------|---------|---------------|------|
| 基础UI | button.tsx | Button | ✅ 已升级 |
| 基础UI | card.tsx | Card | ✅ 已升级 |
| 基础UI | input.tsx | Input | ✅ 已升级 |
| 基础UI | label.tsx | Label | ✅ 已升级 |
| 基础UI | badge.tsx | Badge | ✅ 已升级 |
| 表单 | - | Form | ✅ 已添加 |
| 表单 | - | Select | ✅ 已添加 |
| 数据展示 | - | Table | ✅ 已添加 |
| 反馈 | - | Alert | ✅ 已添加 |
| 导航 | Navigation.tsx | Sidebar + NavigationMenu | 🔄 升级中 |
| 导航 | UserMenu.tsx | DropdownMenu + Avatar | 🔄 升级中 |
| 覆盖层 | - | Dialog | ✅ 已添加 |

### 组件开发标准

**文件结构**:
```
apps/web/components/
├── ui/                          # shadcn/ui基础组件
│   ├── button.tsx              # 基础按钮组件
│   ├── card.tsx                # 卡片组件
│   ├── form.tsx                # 表单组件
│   ├── BizLinkLogo.tsx         # 品牌Logo组件
│   └── ...
├── layout/                      # 布局组件
│   ├── Navigation.tsx          # 主导航
│   ├── UserMenu.tsx            # 用户菜单
│   └── ...
├── features/                    # 功能组件
│   ├── work-orders/            # 工单相关组件
│   ├── assets/                 # 资产相关组件
│   └── ...
└── forms/                       # 表单组件
    ├── LoginForm.tsx           # 登录表单
    ├── WorkOrderCreateForm.tsx # 工单创建表单
    └── ...
```

**命名约定**:
- 组件文件使用PascalCase: `ButtonComponent.tsx`
- 组件导出使用命名导出: `export const Button = ...`
- 类型定义使用Interface: `interface ButtonProps`
- CSS类名使用kebab-case: `btn-primary`

**TypeScript规范**:
```typescript
// 组件Props接口定义
interface ComponentProps {
  className?: string
  children?: React.ReactNode
  variant?: 'default' | 'primary' | 'secondary'
  size?: 'sm' | 'md' | 'lg'
}

// 组件实现
export const Component: React.FC<ComponentProps> = ({
  className = '',
  children,
  variant = 'default',
  size = 'md',
  ...props
}) => {
  return (
    <div 
      className={cn(baseStyles, variantStyles[variant], sizeStyles[size], className)}
      {...props}
    >
      {children}
    </div>
  )
}
```

### 样式系统

**CSS-in-JS策略**:
- 使用Tailwind CSS作为主要样式系统
- 利用class-variance-authority (CVA)进行变体管理
- CSS变量用于主题和品牌色彩

**响应式断点**:
```css
/* Tailwind CSS 断点 */
sm: 640px
md: 768px
lg: 1024px
xl: 1280px
2xl: 1536px
```

**组件变体示例**:
```typescript
import { cva } from 'class-variance-authority'

const buttonVariants = cva(
  'inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors',
  {
    variants: {
      variant: {
        default: 'bg-bizlink-500 text-white hover:bg-bizlink-600',
        secondary: 'bg-neutral-200 text-neutral-900 hover:bg-neutral-300',
        outline: 'border border-bizlink-500 text-bizlink-500 hover:bg-bizlink-50',
      },
      size: {
        sm: 'h-8 px-3 text-xs',
        md: 'h-10 px-4',
        lg: 'h-12 px-6 text-base',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'md',
    },
  }
)
```

## 设计模式

### 1. 布局模式

**三部分页面布局结构**:
```typescript
// 标准三部分布局模式
<div className="min-h-screen flex flex-col">
  {/* 1. Full-width Header */}
  <HeaderBlock 
    title="页面标题"
    subtitle="页面副标题" 
    notificationCount={3}
    onSearch={(query) => console.log('Search:', query)}
  />
  
  {/* 2. Main Layout Container */}
  <div className="flex flex-1 overflow-hidden">
    {/* 3. Collapsible Sidebar */}
    <SidebarProvider>
      <AppSidebar />
      
      {/* 4. Main Content Area */}
      <main className="flex-1 flex flex-col overflow-hidden">
        <PageContent>
          {children}
        </PageContent>
      </main>
    </SidebarProvider>
  </div>
</div>
```

**布局组件说明**:
- **HeaderBlock**: 全宽度顶部区域，包含BizLink Logo、页面标题和全局搜索
- **AppSidebar**: 可折叠左侧导航栏，支持角色基础访问控制
- **Main Content**: 主内容区域，根据侧边栏状态自动调整宽度

**卡片布局模式**:
```typescript
<Card>
  <CardHeader>
    <CardTitle>标题</CardTitle>
    <CardDescription>描述</CardDescription>
  </CardHeader>
  <CardContent>
    内容区域
  </CardContent>
  <CardFooter>
    操作按钮
  </CardFooter>
</Card>
```

### 2. 表单设计模式

**统一表单结构**:
```typescript
<Form {...form}>
  <form onSubmit={form.handleSubmit(onSubmit)}>
    <FormField
      control={form.control}
      name="fieldName"
      render={({ field }) => (
        <FormItem>
          <FormLabel>字段标签</FormLabel>
          <FormControl>
            <Input {...field} />
          </FormControl>
          <FormDescription>字段说明</FormDescription>
          <FormMessage />
        </FormItem>
      )}
    />
    <Button type="submit">提交</Button>
  </form>
</Form>
```

### 3. 数据展示模式

**表格设计**:
```typescript
<Table>
  <TableHeader>
    <TableRow>
      <TableHead>列标题</TableHead>
    </TableRow>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableCell>数据内容</TableCell>
    </TableRow>
  </TableBody>
</Table>
```

**状态指示器**:
```typescript
// 工单状态示例
const statusConfig = {
  pending: { 
    label: '待处理', 
    variant: 'secondary',
    color: 'bg-neutral-500' 
  },
  in_progress: { 
    label: '进行中', 
    variant: 'default',
    color: 'bg-bizlink-500' 
  },
  completed: { 
    label: '已完成', 
    variant: 'success',
    color: 'bg-green-500' 
  },
}
```

## 可访问性标准

### WCAG 2.1 合规性

**颜色对比度**:
- 正常文本: 最小对比度4.5:1
- 大文本: 最小对比度3:1
- 非文本元素: 最小对比度3:1

**键盘导航**:
- 所有交互元素支持Tab键导航
- 使用合适的focus指示器
- 支持键盘快捷键操作

**屏幕阅读器支持**:
- 正确的ARIA标签和角色
- 有意义的alt文本
- 逻辑的标题层次结构

**实施检查清单**:
- [ ] 颜色对比度测试通过
- [ ] 键盘导航完整
- [ ] 屏幕阅读器兼容
- [ ] 语义化HTML结构
- [ ] 错误信息清晰易懂

## 性能优化

### 组件性能

**代码分割**:
```typescript
// 动态导入大型组件
const HeavyComponent = dynamic(() => import('./HeavyComponent'), {
  loading: () => <Skeleton />,
  ssr: false
})
```

**图片优化**:
```typescript
// Next.js Image组件优化
<Image
  src="/path/to/image.jpg"
  alt="描述"
  width={300}
  height={200}
  priority={isAboveFold}
  placeholder="blur"
  blurDataURL="data:image/..."
/>
```

**CSS优化**:
- 使用Tailwind CSS的JIT模式
- 移除未使用的CSS类
- 优化关键渲染路径

### 构建优化

**Bundle分析**:
```bash
# 分析构建包大小
npm run analyze

# Tailwind CSS优化
npm run build:css
```

## 测试策略

### 视觉回归测试

**组件测试**:
```typescript
// 组件单元测试
import { render, screen } from '@testing-library/react'
import { Button } from './Button'

describe('Button', () => {
  it('renders with correct variant', () => {
    render(<Button variant="primary">Click me</Button>)
    expect(screen.getByRole('button')).toHaveClass('bg-bizlink-500')
  })
})
```

**视觉测试**:
```typescript
// Storybook visual testing
export default {
  title: 'Components/Button',
  component: Button,
} as Meta

export const Primary: Story = {
  args: {
    variant: 'primary',
    children: 'Primary Button',
  },
}
```

### 可访问性测试

**自动化测试**:
```typescript
import { axe, toHaveNoViolations } from 'jest-axe'

expect.extend(toHaveNoViolations)

test('should not have accessibility violations', async () => {
  const { container } = render(<Component />)
  const results = await axe(container)
  expect(results).toHaveNoViolations()
})
```

## 实施指导

### 迁移策略

**阶段1: 基础组件** (已完成)
- ✅ 升级button, card, input, label, badge
- ✅ 集成shadcn/ui核心组件
- ✅ 配置品牌配色系统

**阶段2: 导航和布局** (已完成)
- ✅ 三部分布局架构实现
- ✅ HeaderBlock组件创建和集成
- ✅ AppSidebar可折叠行为验证
- ✅ BizLink Logo集成和响应式优化

**阶段3: 表单组件** (计划中)
- 📋 表单统一设计模式
- 📋 日期选择器集成
- 📋 表单验证标准化

**阶段4: 数据展示** (计划中)
- 📋 数据卡片统一
- 📋 图表组件升级
- 📋 KPI展示优化

**阶段5: 交互组件** (计划中)
- 📋 模态框标准化
- 📋 表格功能增强
- 📋 动画效果统一

### 开发工作流

**组件开发流程**:
1. 设计系统规范确认
2. shadcn/ui组件获取和定制
3. 品牌配色应用
4. TypeScript类型定义
5. 单元测试编写
6. 可访问性测试
7. 视觉回归测试
8. 文档更新

**质量检查清单**:
- [ ] 遵循设计系统规范
- [ ] 品牌配色正确应用
- [ ] TypeScript类型完整
- [ ] 单元测试覆盖率>80%
- [ ] 可访问性测试通过
- [ ] 响应式设计验证
- [ ] 性能基准测试
- [ ] 文档完整更新

## 维护和更新

### 设计系统版本管理

**版本号规范**: 遵循语义化版本 (Semantic Versioning)
- 主版本号: 破坏性变更
- 次版本号: 新增功能
- 修订号: 问题修复

**变更记录**:
- v1.0.0 (2025-08): 初始设计系统建立
- v1.1.0 (计划): 导航系统重构完成
- v1.2.0 (计划): 表单组件统一完成

### 组件库维护

**定期审查**:
- 月度设计系统评审
- 季度组件性能分析
- 年度可访问性审计

**更新流程**:
1. 需求收集和评估
2. 设计系统影响分析
3. 技术实施规划
4. 测试和验证
5. 文档更新
6. 团队培训

---

**文档版本**: v1.0  
**最后更新**: 2025-08-16  
**负责人**: Product Manager & Frontend Architecture Team