# 6. 史诗详情 (Epic Details)

## 史诗 1: 基础架构与核心报修流程

**目标**: 这个史诗的目标是搭建整个项目的技术地基，并交付一个完整的、最小化的核心产品闭环：一个用户可以注册登录，看到设备并成功提交一个维修请求。完成后，我们将拥有一个可以运行的、包含核心数据的系统骨架。

### 故事 1.1: 项目初始化与技术栈搭建

**作为一个** 开发人员,

**我想要** 一个配置好的 Monorepo 代码仓库，其中包含前端(Next.js)、后端(Node.js)和移动端(Flutter)的应用骨架,

**以便于** 我可以在一个一致和标准化的环境中开始功能开发。

**验收标准**:

- Monorepo 仓库已使用指定工具初始化。
- Web、API 和 Mobile 三个独立的应用/包已创建。
- 数据库(PostgreSQL)连接已通过 Prisma ORM 配置成功。
- 基础的 Linting 和格式化规则已配置。

### 故事 1.2: 用户认证与角色管理

**作为一个** 用户 (员工、技术员、主管),

**我想要** 能够注册和登录系统,

**以便于** 系统可以识别我的身份并授予我相应角色的访问权限。

**验收标准**:

- 提供用户注册和登录的 API 端点。
- 用户数据（包括加密后的密码）能被安全地存储在数据库中。
- 系统需包含至少三种角色：员工、技术员、主管。
- 登录成功后，系统返回一个用于身份验证的凭证 (Token)。

### 故事 1.3: 核心主数据管理 API

**作为一个** 系统管理员,

**我想要** 能够通过 API 对核心主数据（特别是设备清单）进行增、删、改、查操作,

**以便于** 为系统的正常运作提供必要的初始数据。

**验收标准**:

- 提供针对"设备/资产"资源的 CRUD (创建、读取、更新、删除) API 端点。
- API 端点受权限保护，只有特定角色（如主管）才能调用。
- 支持通过 API 进行设备主数据的批量导入。

### 故事 1.4: (移动端) 发起维修请求

**作为一个** 一线员工,

**我想要** 使用移动应用扫描设备码，填写一个包含位置、类别、图片和优先级的表单来提交维修请求,

**以便于** 我可以快速、准确、全面地报告设备故障。

**验收标准**:

- 用户可以在移动应用上成功登录。
- 应用可以通过摄像头扫描资产二维码，并调用 API 获取设备信息（包括其常规位置）自动填充表单。
- 用户必须选择一个具体的报修类别和报修原因（从预设列表中选择）。
- 用户可以手动输入或选择一个更精确的设备地点。
- 用户可以选填一段文字作为补充报修内容。
- 用户可以从相册选择或现场拍摄一张照片并附加到表单中，并支持在照片上进行简单的圈点标注。
- 用户可以为该维修请求选择一个预设的优先级（如：高、中、低）。
- 成功提交后，系统在数据库中创建一条新的工单记录，初始状态为"待处理"。

## 史诗 2: 工单管理与处理

**目标**: 这个史诗的核心目标是为维修技术员和主管提供一个完整的工单处理闭环。当这个史诗完成后，一个报修单从被创建开始，可以被顺利地指派、接收、处理、更新，直到最终完成归档，整个过程都在线上清晰可见。此外，系统将支持完整的跨平台照片管理功能，确保移动端采集的维修照片能够在PC端无缝查看和管理，为维修记录提供完整的可视化文档支持。

### 故事 2.1: 工单分配与通知

**作为一个** 设备部门主管,

**我想要** 系统能根据预设规则（如设备、区域、类别）自动分配新工单，并支持我手动调整,

**以便于** 提升派工效率，确保每个任务都有明确的负责人。

**验收标准**:

- 系统后台应提供一个简单的规则配置界面，用于设定自动派工的条件。
- 当新报修请求符合规则时，系统自动将其分配给指定的技术员。
- 被分配的技术员会收到新任务的通知。
- 主管可以在 Web 管理端手动将工单指派或改派给任何技术员。

### 故事 2.2: (Web/移动端) 工单处理与状态更新

**作为一个** 维修技术员,

**我想要** 在我的任务列表中查看工单，并能在执行过程中随时更新其状态,

**以便于** 高效管理我的工作，并让所有相关人员了解最新进展。

**验收标准**:

- 技术员登录后，可以在 Web 端和移动端看到一个"我的任务"列表。
- 技术员可以打开工单详情，查看所有报修信息、设备历史和附加文档。
- 技术员可以将工单状态从"待处理"更新为"进行中"或"等待备件"等。
- 工单状态的任何变更都会被记录，并对主管可见。

### 故事 2.3: (Web/移动端) 记录解决方案与完成工单

**作为一个** 维修技术员,

**我想要** 在维修完成后，方便地记录解决方案、填写故障代码并上传完成照片,

**以便于** 为设备建立完整的维护档案，并正式关闭工单。

**验收标准**:

- 在工单详情页，技术员可以将工单标记为"已完成"。
- 标记完成时，需要填写解决方案描述、选择故障代码（可选）。
- 技术员可以上传维修完成后的照片作为证明。
- 工单关闭后，所有相关信息会自动归档到对应资产的维护历史中。

### 故事 2.4: 工单状态跟踪与历史记录

**作为一个** 设备部门主管,

**我想要** 能够查看工单的完整状态变更历史和处理时间线,

**以便于** 监控处理效率并进行流程优化分析。

**验收标准**:

- 每个工单的状态变更都有完整的时间戳和操作人记录。
- 主管可以查看工单从创建到关闭的完整时间线。
- 系统能够生成工单处理时间的统计报告。
- 支持按时间段、技术员、设备类型等维度进行处理效率分析。

### 故事 2.5: 工单照片存储与跨平台显示

**作为一个** 维修技术员和设备主管,

**我想要** 移动端拍摄的工单照片能够安全存储到服务器，并且PC端能够查看和管理这些照片,

**以便于** 维修记录更加完整，跨平台协作更高效，照片资料便于长期存档和分析。

**验收标准**:

- 移动端用户能够在创建工单时上传设备故障照片到服务器。
- 移动端用户能够在工单完成时上传维修后的解决方案照片到服务器。
- PC端用户能够查看移动端上传的所有工单相关照片（故障照片和解决方案照片）。
- 照片存储系统按年月自动分类，支持缩略图生成和全尺寸查看。
- 照片访问具有适当的权限控制，只有相关工单的参与者才能查看照片。

## 史诗 3: KPI 仪表板与管理视图

**目标**: 这个史诗的目标是为管理者赋能。我们将利用前两个史诗积累的数据，构建一个强大的数据可视化和管理中心。完成后，主管不仅能宏观掌握维护工作的整体态势，还能对用户和设备等主数据进行日常管理。

### 故事 3.1: KPI 仪表板数据可视化

**作为一个** 设备部门主管,

**我想要** 在 Web 应用首页看到一个清晰、可视化的 KPI 仪表板,

**以便于** 我可以快速理解当前的工作负载、团队效率和整体资产健康状况。

**验收标准**:

- Web 应用的主管视图首页即为 KPI 仪表板。
- 仪表板必须包含"工单指标"模块，例如使用饼图展示不同状态的工单分布。
- 仪表板必须包含"时间指标"模块，展示关键指标如 MTTR。
- 仪表板必须包含"资产中心指标"模块，例如展示总停机时间最长的前 5 个设备。
- 仪表板上的所有数据需接近实时更新。

### 故事 3.2: 工单列表的高级筛选与查询

**作为一个** 设备部门主管,

**我想要** 能够通过多种条件（如状态、负责人、设备、日期范围）来筛选和搜索所有的工单,

**以便于** 我可以进行深入的分析和问题追溯。

**验收标准**:

- 提供一个工单管理页面，以列表形式展示所有工单。
- 列表上方提供搜索框和多个筛选条件。
- 筛选结果可以被导出为 CSV 文件。

### 故事 3.3: (Web) 用户与设备主数据管理

**作为一个** 设备部门主管,

**我想要** 一个简单的 Web 界面来管理用户和设备主数据,

**以便于** 我可以进行日常的人员调配和设备信息更新。

**验收标准**:

- 系统提供一个"用户管理"页面，主管可以对用户进行 CRUD 及角色分配。
- 系统提供一个"设备管理"页面，主管可以对设备资产进行 CRUD。
- 所有管理操作都受权限保护，仅主管及以上角色可访问。

## 史诗 4: Web 端用户登录界面

**目标**: 这个史诗的目标是为 Web 应用实现完整的用户登录和认证流程。虽然后端认证 API 已在史诗 1 中实现，但 Web 端仍缺少登录界面。完成后，用户将能够通过 Web 界面安全登录系统，根据其角色访问相应功能。

### 故事 4.1: 登录页面实现

**作为一个** 系统用户（员工、技术员、主管、管理员）,

**我想要** 通过一个专门的登录页面输入我的凭证进行身份验证,

**以便于** 我可以安全地访问系统并使用与我角色相关的功能。

**验收标准**:

- 创建 `/login` 路由和登录页面组件。
- 页面包含邮箱/用户名和密码输入框，使用 ShadCN/UI 组件。
- 实现表单验证，确保必填字段不为空。
- 登录按钮在请求期间显示加载状态。
- 登录失败时显示清晰的错误消息（如"用户名或密码错误"）。
- 登录成功后自动跳转到 dashboard 页面。

### 故事 4.2: 认证流程集成

**作为一个** 前端开发人员,

**我想要** 实现一个完整的认证流程，包括 token 管理和状态维护,

**以便于** 系统能够安全地处理用户会话并在后续请求中自动附加认证信息。

**验收标准**:

- 创建 `auth-service.ts` 服务，封装对后端 `/api/auth/login` 端点的调用。
- 创建 `auth-store.ts` 使用 Zustand 管理用户认证状态。
- JWT token 安全存储在 localStorage 中（后续可升级为 httpOnly cookies）。
- API 客户端自动在请求头中附加 Bearer token。
- 实现 token 过期检测和自动清理机制。
- 提供登出功能，清理 token 和用户状态。

### 故事 4.3: 路由保护和用户界面集成

**作为一个** 系统用户,

**我想要** 系统能够根据我的登录状态自动控制页面访问权限,

**以便于** 未登录用户无法访问受保护的页面，同时我能够看到自己的登录状态。

**验收标准**:

- 创建认证检查的布局组件，保护 `/dashboard` 路由。
- 未登录用户访问受保护页面时自动重定向到 `/login`。
- 登录后根据用户角色重定向到相应页面：
  - EMPLOYEE: `/dashboard/work-orders`
  - TECHNICIAN: `/dashboard/my-tasks`
  - SUPERVISOR/ADMIN: `/dashboard`
- 在导航栏显示当前登录用户的名称和角色。
- 导航栏包含"退出登录"按钮，点击后清理认证状态并返回登录页。
- 页面刷新后保持登录状态（读取存储的 token）。

## 史诗 5: 资产服务完善与移动端集成

**目标**: 完善资产管理服务的功能实现，确保与用户服务和工单服务的无缝集成，同时优化移动端的资产扫描和管理功能。

### 故事 5.1: 资产服务实现完善

**作为一个** 系统管理员和技术员,
**我想要** 一个完整功能的资产管理服务，支持资产的CRUD操作、QR码管理和与工单系统的集成,
**以便于** 高效管理设备资产，支持维修工作流程的顺畅进行。

**验收标准**:
- 完善资产服务的所有CRUD API端点实现
- 集成QR码生成和管理功能
- 建立与工单服务的数据关联
- 实现资产状态跟踪和历史记录
- 添加资产导入导出功能
- 完善错误处理和数据验证

## 史诗 6: UI重设计与品牌集成

**目标**: 完全重新设计用户界面组件，集成BizLink公司品牌元素，使用标准shadcn/ui组件库，提升整体用户体验和品牌一致性。这个史诗将分5个阶段系统性地升级整个前端UI体系。

### 阶段实施概览

Epic 6 按照以下5个阶段进行实施，每个阶段对应一个或多个故事：

**阶段 1: 基础组件升级** (Story 6.1 - 已完成)
- 升级基础UI组件（button, card, input, label, badge）为shadcn/ui标准
- 集成BizLink品牌配色系统
- 建立组件使用文档和类型定义

**阶段 2: 导航和布局重设计** (Story 6.2)
- 导航系统重构使用shadcn/ui sidebar和navigation组件
- 集成BizLink公司Logo
- 优化移动端响应式设计
- 用户菜单使用dropdown-menu + avatar重构

**阶段 3: 表单组件重构** (Story 6.3)
- 统一表单设计模式使用shadcn/ui form组件
- 集成calendar、select、textarea等表单组件
- 统一表单验证和错误处理

**阶段 4: 数据展示优化** (Story 6.4)
- 卡片组件统一使用shadcn/ui card设计
- 图表组件升级和数据可视化优化
- 统计卡片和KPI展示组件标准化

**阶段 5: 交互组件完善** (Story 6.5)
- 模态框标准化使用shadcn/ui dialog
- 表格功能增强，集成pagination、checkbox、dropdown-menu
- 统一动画效果和交互逻辑

### BizLink品牌设计系统规范

**配色方案**:
- **主品牌色**: #1E88E5 (BizLink标准蓝色)
- **品牌色变体**: 
  - 浅蓝: #42A5F5
  - 深蓝: #1565C0  
  - 最深蓝: #0D47A1
- **系统功能色**:
  - 成功绿: #2E7D32
  - 警告橙: #F57C00
  - 错误红: #C62828
  - 信息青: #0097A7

**Logo集成规范**:
- 导航栏Logo: 左上角位置，高度32px (响应式调整)
- 登录页面: 居中展示，高度60px
- 移动端适配: 最小高度24px，保持宽高比
- 背景要求: 白色或浅色背景确保对比度

### 故事 6.1: UI基础组件升级与shadcn/ui集成 (已完成)

**作为一个** 前端开发人员,
**我想要** 将现有的基础UI组件升级为标准的shadcn/ui组件，并应用BizLink品牌配色系统,
**以便于** 系统能够拥有统一、现代化的界面设计和更好的代码维护性。

**验收标准**:
- 升级现有基础UI组件（button, card, input, label, badge）为shadcn/ui标准组件
- 集成BizLink品牌配色系统到Tailwind CSS配置中
- 添加新的shadcn/ui核心组件（dialog, form, table, alert, select）
- 确保所有组件遵循统一的设计规范和品牌标识
- 更新组件使用文档和类型定义
- 所有现有测试保持通过，新组件包含基础测试
- 保持现有功能完全兼容，不破坏现有业务逻辑

### 故事 6.2: 导航系统重构与品牌集成

**作为一个** 系统用户（员工、技术员、主管、管理员）,
**我想要** 一个现代化的导航系统，集成BizLink公司品牌元素，使用shadcn/ui标准组件,
**以便于** 我能够享受更好的用户体验，同时感受到统一的品牌形象和专业的界面设计。

**验收标准**:
- 重新设计 `Navigation.tsx` 组件，使用 shadcn/ui `sidebar` 和相关导航组件
- 在导航栏左上角集成 BizLink 公司 Logo，遵循品牌规范
- 优化移动端响应式设计，确保在所有设备上的良好体验
- 使用 shadcn/ui `dropdown-menu` + `avatar` 重构用户菜单组件
- 应用 BizLink 品牌配色系统到导航组件中
- 保持现有的角色基础访问控制逻辑
- 确保所有现有导航功能正常工作，不破坏现有业务流程
- 添加面包屑导航支持（可选增强功能）

### 故事 6.3: 表单组件重构与统一设计

**作为一个** 系统用户,
**我想要** 所有表单组件使用统一的shadcn/ui设计模式，提供一致的交互体验,
**以便于** 提升表单填写效率，减少学习成本，确保数据输入的准确性。

**验收标准**:
- 所有表单使用 shadcn/ui `form` 组件重构
- 集成 `calendar` 组件用于日期选择替换现有日期输入
- 使用 `select` 组件优化所有下拉选择
- 添加 `textarea` 组件用于多行文本输入
- 统一表单验证和错误处理显示
- 添加 `progress` 组件显示表单提交状态
- 优化表单用户体验流程和视觉反馈
- 确保所有现有表单功能保持不变

### 故事 6.4: 数据展示组件优化与可视化升级

**作为一个** 管理人员和系统用户,
**我想要** 统一的数据展示组件和优化的可视化效果,
**以便于** 更直观地理解系统数据，提升决策效率和信息获取体验。

**验收标准**:
- 所有数据卡片使用统一的 shadcn/ui `card` 设计
- 集成 `badge` 和 `progress` 组件优化信息层次结构
- 升级图表组件集成 shadcn/ui `chart` 组件
- 优化KPI仪表板的数据可视化效果
- 统计卡片和指标展示组件标准化
- 确保数据展示的响应式设计
- 优化加载状态和空状态的用户体验

### 故事 6.5: 交互组件完善与用户体验优化

**作为一个** 系统用户,
**我想要** 标准化的交互组件和流畅的动画效果,
**以便于** 享受现代化的用户界面交互体验，提升操作效率。

**验收标准**:
- 所有弹窗使用 shadcn/ui `dialog` 组件标准化
- 使用 shadcn/ui `table` 组件增强表格功能
- 集成 `pagination`, `checkbox`, `dropdown-menu` 到表格中
- 添加表格排序和筛选功能
- 统一动画效果和交互逻辑
- 优化模态框的打开和关闭体验
- 确保所有交互组件的可访问性标准

### Epic 6 技术实施指导

**shadcn/ui组件集成策略**:
- 使用shadcn/ui MCP服务获取标准组件源码
- 确保组件与项目TypeScript配置兼容
- 保持组件API接口向后兼容性
- 建立组件使用文档和导入标准

**品牌配色集成**:
- 更新tailwind.config.js配置BizLink品牌色彩
- 配置CSS变量支持品牌配色系统
- 建立颜色使用规范和指导原则

**质量保证要求**:
- 所有组件遵循统一设计规范
- 品牌配色正确应用和一致性验证
- 响应式设计测试通过
- TypeScript类型检查通过
- 单元测试覆盖率维持或提升
- 现有功能完全兼容，无回归问题

**风险缓解策略**:
- 渐进式迁移，分阶段实施确保稳定性
- 每个组件迁移后立即更新相关测试
- 保持向后兼容性，避免破坏现有业务逻辑
- 建立组件迁移检查清单和验证流程
