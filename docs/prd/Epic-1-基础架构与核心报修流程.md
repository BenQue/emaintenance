# 1. 史诗详情 - Epic 1: 基础架构与核心报修流程

## 史诗概述

**史诗目标**: 这个史诗的目标是搭建整个项目的技术地基，并交付一个完整的、最小化的核心产品闭环：一个用户可以注册登录，看到设备并成功提交一个维修请求。完成后，我们将拥有一个可以运行的、包含核心数据的系统骨架。

**史诗类型**: Foundation Epic (基础架构史诗)

**估计工作量**: 4 个故事

## 业务价值

### 问题陈述

当前的企业设备维修流程依赖于手动的 Excel 事后记录，这导致了效率低下、信息不透明和数据追踪困难等问题。需要建立一个数字化的维修管理系统基础。

### 解决方案

通过建立完整的技术基础架构和核心业务流程，实现从传统手工流程到数字化系统的转变，为后续功能开发奠定坚实基础。

### 预期收益

- **技术基础**: 建立标准化的开发环境和架构模式
- **核心闭环**: 实现从用户登录到提交维修请求的完整业务闭环
- **数据基础**: 建立核心主数据管理能力
- **移动优先**: 实现以移动端为主的维修请求提交流程

## 功能需求

### 核心功能

1. **项目基础架构**
   - Monorepo 代码仓库配置
   - 前端(Next.js)、后端(Node.js)、移动端(Flutter)应用骨架
   - 数据库(PostgreSQL)和 ORM(Prisma) 配置
   - 基础开发规范和工具配置

2. **用户认证系统**
   - 用户注册和登录 API
   - 角色管理系统(员工、技术员、主管)
   - JWT 令牌认证机制
   - 安全的密码存储和验证

3. **主数据管理**
   - 设备/资产 CRUD API
   - 权限保护的数据访问
   - 批量数据导入支持

4. **移动端维修请求**
   - 移动应用用户登录
   - QR 码扫描设备识别
   - 维修请求表单提交
   - 图片上传和标注功能

## 技术规范

### 架构设计

**技术栈**:
- 前端(Web): React/Next.js + ShadCN/UI
- 移动端: Flutter
- 后端: Node.js + Express + Prisma ORM
- 数据库: PostgreSQL
- 认证: JWT

**架构模式**:
- Monorepo 仓库结构
- 微服务架构
- Controller-Service-Repository 模式

### 数据模型

**核心实体**:
```sql
-- 用户表
Table User {
  id: String (primary key)
  email: String (unique)
  username: String (unique)
  password: String (hashed)
  role: UserRole (EMPLOYEE, TECHNICIAN, SUPERVISOR, ADMIN)
  createdAt: DateTime
  updatedAt: DateTime
}

-- 资产表
Table Asset {
  id: String (primary key)
  assetCode: String (unique)
  name: String
  location: String
  category: String
  createdAt: DateTime
  updatedAt: DateTime
}

-- 工单表
Table WorkOrder {
  id: String (primary key)
  title: String
  description: String?
  assetId: String (foreign key)
  requestorId: String (foreign key)
  status: WorkOrderStatus
  priority: Priority
  createdAt: DateTime
  updatedAt: DateTime
}
```

### API设计

**认证端点**:
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出

**资产管理端点**:
- `GET /api/assets` - 获取资产列表
- `POST /api/assets` - 创建新资产
- `PUT /api/assets/:id` - 更新资产信息
- `DELETE /api/assets/:id` - 删除资产

**工单端点**:
- `POST /api/work-orders` - 创建维修请求

## 故事分解

### 故事 1.1: 项目初始化与技术栈搭建

**作为一个** 开发人员,
**我想要** 一个配置好的 Monorepo 代码仓库，其中包含前端(Next.js)、后端(Node.js)和移动端(Flutter)的应用骨架,
**以便于** 我可以在一个一致和标准化的环境中开始功能开发。

**验收标准**:
- Monorepo 仓库已使用指定工具初始化
- Web、API 和 Mobile 三个独立的应用/包已创建
- 数据库(PostgreSQL)连接已通过 Prisma ORM 配置成功
- 基础的 Linting 和格式化规则已配置

### 故事 1.2: 用户认证与角色管理

**作为一个** 用户 (员工、技术员、主管),
**我想要** 能够注册和登录系统,
**以便于** 系统可以识别我的身份并授予我相应角色的访问权限。

**验收标准**:
- 提供用户注册和登录的 API 端点
- 用户数据（包括加密后的密码）能被安全地存储在数据库中
- 系统需包含至少三种角色：员工、技术员、主管
- 登录成功后，系统返回一个用于身份验证的凭证 (Token)

### 故事 1.3: 核心主数据管理 API

**作为一个** 系统管理员,
**我想要** 能够通过 API 对核心主数据（特别是设备清单）进行增、删、改、查操作,
**以便于** 为系统的正常运作提供必要的初始数据。

**验收标准**:
- 提供针对"设备/资产"资源的 CRUD (创建、读取、更新、删除) API 端点
- API 端点受权限保护，只有特定角色（如主管）才能调用
- 支持通过 API 进行设备主数据的批量导入

### 故事 1.4: (移动端) 发起维修请求

**作为一个** 一线员工,
**我想要** 使用移动应用扫描设备码，填写一个包含位置、类别、图片和优先级的表单来提交维修请求,
**以便于** 我可以快速、准确、全面地报告设备故障。

**验收标准**:
- 用户可以在移动应用上成功登录
- 应用可以通过摄像头扫描资产二维码，并调用 API 获取设备信息（包括其常规位置）自动填充表单
- 用户必须选择一个具体的报修类别和报修原因（从预设列表中选择）
- 用户可以手动输入或选择一个更精确的设备地点
- 用户可以选填一段文字作为补充报修内容
- 用户可以从相册选择或现场拍摄一张照片并附加到表单中，并支持在照片上进行简单的圈点标注
- 用户可以为该维修请求选择一个预设的优先级（如：高、中、低）
- 成功提交后，系统在数据库中创建一条新的工单记录，初始状态为"待处理"

## 验收标准

### 功能验收

1. ✅ **项目架构完整**: Monorepo 结构正确配置，所有应用可以正常构建和运行
2. ✅ **认证系统工作**: 用户可以注册、登录，JWT 令牌正确生成和验证
3. ✅ **主数据管理**: 资产 CRUD API 完整实现并受权限保护
4. ✅ **移动端集成**: 移动应用可以扫码、提交维修请求，数据正确存储

### 质量验收

5. ✅ **代码质量**: 所有代码通过 Linting 检查，遵循项目规范
6. ✅ **测试覆盖**: 核心 API 端点有基础单元测试
7. ✅ **安全性**: 密码正确加密，API 端点有权限验证
8. ✅ **数据完整性**: 数据库约束正确设置，数据验证完整

## 风险评估与缓解

### 主要风险

**风险**: 技术栈集成复杂度可能导致初始配置时间超预期

**缓解措施**:
- 使用成熟的脚手架工具快速初始化项目
- 优先实现最小可用版本，逐步完善功能
- 建立清晰的开发环境配置文档

**风险**: 移动端开发环境配置可能遇到平台兼容性问题

**缓解措施**:
- 提前验证 Flutter 开发环境
- 准备多种平台的测试设备
- 建立移动端 CI/CD 流程

## 成功标准

史诗完成的标准:

1. ✅ 技术架构建立完整且可扩展
2. ✅ 核心业务闭环可以端到端运行
3. ✅ 移动端优先的用户体验得到验证
4. ✅ 为后续史诗开发奠定坚实基础
5. ✅ 所有安全和质量要求得到满足

## 变更记录

| 日期 | 版本 | 描述 | 作者 |
|------|------|------|------|
| 2025-08-17 | 1.0 | 从综合史诗详情文档中提取创建独立Epic 1文件 | John, PM |

## 备注

此史诗是整个项目的基础，其成功完成对后续所有史诗的实施至关重要。重点关注技术架构的可扩展性和业务流程的完整性。