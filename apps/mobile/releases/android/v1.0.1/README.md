# E-Maintenance v1.0.1 修复版本

## 🔧 版本修复内容

### 主要问题修复
1. **API 路径问题修复**
   - ✅ 修正了所有 API 请求路径，使其与服务器配置匹配
   - ✅ 统一使用基础 URL `http://10.163.144.13:3030`
   - ✅ 修复了认证、工单、资产服务的路径配置

2. **调试功能增强**
   - ✅ 添加了详细的请求/响应日志
   - ✅ 增加了错误信息的详细输出
   - ✅ 便于问题追踪和诊断

## 📦 APK 文件信息

| 文件名 | 大小 | 版本 | 构建时间 |
|--------|------|------|----------|
| emaintenance-v1.0.1-release.apk | 34MB | v1.0.1+2 | 2025-09-01 16:51 |

## 🚀 安装说明

### 重要提示
⚠️ **必须先卸载旧版本（v1.0.0）再安装新版本**

### 安装步骤
```bash
# 1. 卸载旧版本
adb uninstall com.example.emaintenance_mobile

# 2. 安装新版本
adb install emaintenance-v1.0.1-release.apk
```

### 手动安装
1. 卸载手机上的旧版本 E-Maintenance 应用
2. 将 APK 文件传输到 Android 设备
3. 点击安装新版本

## 📝 修复详情

### API 路径修正前后对比

| 服务 | 旧路径（错误） | 新路径（正确） |
|------|---------------|----------------|
| 登录 | /api/auth/login | /user-service/api/auth/login |
| 工单 | /api/work-orders | /work-order-service/api/work-orders |
| 资产 | /api/assets | /asset-service/api/assets |

### 服务器配置
- **基础 URL**: `http://10.163.144.13:3030`
- **Nginx 代理**: 端口 3030
- **后端服务**: 
  - user-service: 3001
  - work-order-service: 3002
  - asset-service: 3003

## 🐛 调试日志说明

应用现在会输出以下调试信息：
- 🔵 蓝色圆点：请求信息（方法、URL、头部、数据）
- 🔴 红色圆点：错误信息（类型、消息、状态码、响应）

### 查看调试日志
```bash
# 连接设备后运行
adb logcat | grep -E "flutter|emaintenance"
```

## ⚠️ 已知问题和解决方案

### 1. "未知错误"的可能原因
- **网络连接**：确保设备与服务器在同一局域网
- **服务器状态**：检查服务器是否正常运行
- **防火墙**：确认 3030 端口已开放

### 2. Android 11 特殊配置
- 已配置明文传输权限
- 已添加网络安全配置
- 支持 HTTP 请求到内网地址

## 🔍 问题诊断步骤

1. **检查网络连接**
   ```bash
   # 在手机终端或 adb shell 中
   ping 10.163.144.13
   ```

2. **验证服务器状态**
   ```bash
   # 在服务器上
   docker ps
   netstat -tlnp | grep 3030
   ```

3. **查看应用日志**
   ```bash
   adb logcat -c  # 清空日志
   # 打开应用尝试登录
   adb logcat | grep -i "flutter"
   ```

## 📊 测试建议

1. 测试登录功能
2. 创建测试工单
3. 查看资产列表
4. 测试离线功能
5. 验证数据同步

## 🆘 技术支持

如仍有问题，请提供：
1. 设备型号和 Android 版本
2. 错误截图
3. `adb logcat` 输出的调试日志
4. 网络环境描述

---
**版本**: 1.0.1  
**构建号**: 2  
**发布日期**: 2025-09-01