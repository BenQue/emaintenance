# E-Maintenance 分模块部署 - 生产环境配置

# =============================================================================
# 基础设施配置 (Infrastructure)
# =============================================================================

# 数据库配置
POSTGRES_DB=emaintenance
POSTGRES_USER=emaintenance_user
POSTGRES_PASSWORD=CHANGE_THIS_PASSWORD_IN_PRODUCTION
POSTGRES_PORT=5432

# Redis配置  
REDIS_PASSWORD=CHANGE_THIS_REDIS_PASSWORD
REDIS_MAX_MEMORY=2g
REDIS_PORT=6379

# Nginx配置
HTTP_PORT=80
HTTPS_PORT=443
SSL_CERT_DIR=/etc/nginx/ssl

# MinIO对象存储（生产环境推荐）
MINIO_ACCESS_KEY=CHANGE_THIS_ACCESS_KEY
MINIO_SECRET_KEY=CHANGE_THIS_SECRET_KEY_32_CHARS_MIN
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001

# 监控配置
PROMETHEUS_PORT=9090
GRAFANA_PORT=3000
GRAFANA_PASSWORD=CHANGE_THIS_GRAFANA_PASSWORD

# =============================================================================
# 微服务配置 (Microservices) 
# =============================================================================

# JWT认证配置（生产环境必须修改）
JWT_SECRET=CHANGE_THIS_JWT_SECRET_TO_STRONG_KEY_64_CHARS_MIN
JWT_EXPIRES_IN=8h
JWT_REFRESH_EXPIRES_IN=7d

# 会话配置
SESSION_SECRET=CHANGE_THIS_SESSION_SECRET_32_CHARS_MIN

# 安全配置
BCRYPT_ROUNDS=12

# 服务端口配置
USER_SERVICE_PORT=3001
WORK_ORDER_SERVICE_PORT=3002
ASSET_SERVICE_PORT=3003

# 服务发现配置
SERVICE_REGISTRY_URL=consul://consul.internal:8500

# 邮件配置（生产环境推荐配置）
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=noreply@yourcompany.com
SMTP_PASS=YOUR_SMTP_PASSWORD

# 文件上传配置
UPLOAD_MAX_SIZE=100mb
ASSET_IMAGE_MAX_SIZE=20mb

# 功能开关
NOTIFICATION_ENABLED=true
EMAIL_ENABLED=true
WEBHOOK_ENABLED=true
WORKFLOW_ENABLED=true
AUTO_ASSIGNMENT_ENABLED=true
QR_CODE_ENABLED=true

# QR码配置
QR_CODE_BASE_URL=https://yourdomain.com

# 日志级别
LOG_LEVEL=info

# =============================================================================
# 前端配置 (Frontend)
# =============================================================================

# 应用信息
APP_NAME=E-Maintenance
APP_VERSION=1.0.0
APP_DESCRIPTION=企业设备维修管理系统

# 环境设置
NODE_ENV=production
BUILD_TARGET=production
DEBUG_MODE=false

# Web服务端口
WEB_PORT=3000
WEB_BACKUP_PORT=3001
STATIC_SERVER_PORT=8080

# API网关配置（生产环境使用域名）
API_GATEWAY_URL=https://api.yourdomain.com
STATIC_URL=https://static.yourdomain.com
CDN_URL=https://cdn.yourdomain.com
UPLOAD_URL=https://uploads.yourdomain.com

# 移动端配置
MOBILE_API_HOST=api.yourdomain.com
MOBILE_API_PORT=443
MOBILE_API_PROTOCOL=https

# 功能开关
PWA_ENABLED=true
ANALYTICS_ENABLED=true
SECURITY_HEADERS_ENABLED=true
CSP_ENABLED=true

# PWA配置
PWA_CACHE_STRATEGY=cacheFirst
OFFLINE_FALLBACK=true

# 多语言配置
DEFAULT_LOCALE=zh
SUPPORTED_LOCALES=zh,en

# 开发模式配置（生产环境关闭）
WATCH_MODE=false

# =============================================================================
# Docker配置
# =============================================================================

# 镜像标签
IMAGE_TAG=stable
BUILD_VERSION=1.0.0

# 构建目标
BUILD_TARGET=production

# 健康检查配置
HEALTH_CHECK_INTERVAL=60000

# =============================================================================
# 网络和安全配置
# =============================================================================

# 网络配置
NETWORK_NAME=emaintenance-prod-network
SUBNET=172.30.0.0/16

# 安全配置（生产环境启用）
ENABLE_SECURITY_POLICIES=true
READ_ONLY_ROOT_FILESYSTEM=true

# 资源限制（生产环境严格控制）
POSTGRES_MEMORY_LIMIT=4g
POSTGRES_CPU_LIMIT=2
REDIS_MEMORY_LIMIT=2g
REDIS_CPU_LIMIT=1
NGINX_MEMORY_LIMIT=512m
NGINX_CPU_LIMIT=0.5
USER_SERVICE_MEMORY_LIMIT=1g
USER_SERVICE_CPU_LIMIT=0.75
WORK_ORDER_SERVICE_MEMORY_LIMIT=2g
WORK_ORDER_SERVICE_CPU_LIMIT=1.5
ASSET_SERVICE_MEMORY_LIMIT=1g
ASSET_SERVICE_CPU_LIMIT=0.75
WEB_MEMORY_LIMIT=2g
WEB_CPU_LIMIT=1.5

# =============================================================================
# 备份和恢复配置
# =============================================================================

# 数据库备份配置
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # 每天凌晨2点
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=emaintenance-backups
BACKUP_S3_REGION=us-west-2

# 文件备份配置
FILE_BACKUP_ENABLED=true
FILE_BACKUP_SCHEDULE=0 3 * * *  # 每天凌晨3点

# =============================================================================
# 监控和告警配置
# =============================================================================

# Prometheus监控
PROMETHEUS_RETENTION=30d
PROMETHEUS_SCRAPE_INTERVAL=15s

# 告警配置
ALERT_MANAGER_URL=https://alertmanager.yourdomain.com
WEBHOOK_ALERTS_URL=https://hooks.slack.com/YOUR_WEBHOOK_URL
EMAIL_ALERTS_TO=admin@yourcompany.com

# 日志聚合
LOG_AGGREGATION_ENABLED=true
ELASTICSEARCH_URL=https://elasticsearch.yourdomain.com:9200
KIBANA_URL=https://kibana.yourdomain.com

# =============================================================================
# SSL/TLS配置
# =============================================================================

# SSL证书配置
SSL_ENABLED=true
SSL_CERT_FILE=/etc/nginx/ssl/fullchain.pem
SSL_KEY_FILE=/etc/nginx/ssl/privkey.pem
SSL_PROTOCOLS=TLSv1.2 TLSv1.3
SSL_CIPHERS=ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256

# HSTS配置
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000