# ğŸ› E-Maintenance å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

## ğŸ”„ Redis é…ç½®é—®é¢˜

### é—®é¢˜æè¿°
Redis 7.4.5 å¯åŠ¨æ—¶æŠ¥é”™ï¼š`Bad directive or wrong number of arguments` åœ¨é…ç½®æ–‡ä»¶ç¬¬6è¡Œ `keepalive 60`

### é”™è¯¯æ—¥å¿—
```
*** FATAL CONFIG FILE ERROR (Redis 7.4.5) ***
Reading the configuration file, at line 6
>>> 'keepalive 60'
Bad directive or wrong number of arguments
```

### æ ¹æœ¬åŸå› 
Redisé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨äº†é”™è¯¯çš„æŒ‡ä»¤åï¼š
- âŒ **é”™è¯¯**: `keepalive 60`
- âœ… **æ­£ç¡®**: `tcp-keepalive 60`

### è§£å†³æ–¹æ¡ˆ
1. **ä¿®å¤éƒ¨ç½²è„šæœ¬** (å·²ä¿®å¤)
   ```bash
   # æ–‡ä»¶: deploy/Server/infrastructure/deploy.sh
   # ç¬¬102è¡Œ: keepalive 60 â†’ tcp-keepalive 60
   ```

2. **æ‰‹åŠ¨ä¿®å¤ç°æœ‰ç¯å¢ƒ**
   ```bash
   cd ~/emaintenance/deploy/Server/infrastructure/
   sed -i 's/keepalive 60/tcp-keepalive 60/g' redis.conf
   docker-compose restart redis
   ```

3. **éªŒè¯ä¿®å¤**
   ```bash
   docker-compose logs redis --tail 5
   docker exec emaintenance-redis redis-cli ping
   ```

### å½±å“ç‰ˆæœ¬
- Redis 7.4.5
- å½±å“æ‰€æœ‰ä½¿ç”¨ `deploy.sh` è„šæœ¬çš„éƒ¨ç½²

### çŠ¶æ€
- âœ… **å·²ä¿®å¤**: 2025-08-26
- âœ… **æ–‡æ¡£å·²æ›´æ–°**: éƒ¨ç½²æ¸…å•å’Œæ•…éšœæ’æŸ¥æŒ‡å—

## ğŸ”Œ ç«¯å£å†²çªå¤„ç†

### å¸¸è§å†²çªç«¯å£
- **5432** (PostgreSQL): ä½¿ç”¨ 5433 æ›¿ä»£
- **6379** (Redis): ä½¿ç”¨ 6380 æ›¿ä»£  
- **3000** (Webåº”ç”¨): é€šè¿‡ Nginx ä»£ç†ï¼Œå†…éƒ¨ä½¿ç”¨æ— å½±å“

### è§£å†³ç­–ç•¥
1. **è‡ªåŠ¨æ£€æµ‹**: ä½¿ç”¨ `docker-safety-check.sh` æ£€æŸ¥ç«¯å£å†²çª
2. **ç«¯å£æ˜ å°„**: ä¿®æ”¹å¤–éƒ¨ç«¯å£æ˜ å°„ï¼Œä¿æŒå†…éƒ¨ç«¯å£ä¸å˜
3. **ç¯å¢ƒå˜é‡**: é€šè¿‡ `.env` æ–‡ä»¶çµæ´»é…ç½®ç«¯å£

## ğŸ—„ï¸ æ•°æ®åº“åˆå§‹åŒ–é—®é¢˜

### é—®é¢˜æè¿°
æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ `init.sh` å­˜åœ¨å¤šä¸ªé—®é¢˜ï¼š
1. ç«¯å£é…ç½®é»˜è®¤ä½¿ç”¨5432ï¼Œä½†å®é™…æ˜ å°„åˆ°5433
2. æœåŠ¡æ£€æµ‹é€»è¾‘æœ‰è¯¯ï¼Œæ— æ³•æ­£ç¡®è¯†åˆ«è¿è¡Œä¸­çš„PostgreSQL
3. ç¼ºå°‘ä¸»æ•°æ®ï¼ˆMaster Dataï¼‰åˆå§‹åŒ–
4. ç¼ºå°‘æµ‹è¯•æ•°æ®å¡«å……

### è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨ `manual-init.sh` æ‰‹åŠ¨åˆå§‹åŒ–è„šæœ¬ï¼ŒåŒ…å«ï¼š
- âœ… æ­£ç¡®çš„ç«¯å£é…ç½®ï¼ˆ5433ï¼‰
- âœ… åˆ›å»ºæ•°æ®åº“
- âœ… Prismaè¿ç§»ï¼ˆè¡¨ç»“æ„ï¼‰
- âœ… ä¸»æ•°æ®åˆå§‹åŒ–ï¼ˆç”¨æˆ·ã€èµ„äº§ã€å·¥å•ç­‰ï¼‰
- âœ… æµ‹è¯•æ•°æ®å¡«å……

### ä½¿ç”¨æ–¹æ³•
```bash
cd deploy/Server/database/
chmod +x manual-init.sh
./manual-init.sh
```

### å½±å“ç‰ˆæœ¬
- æ‰€æœ‰ä½¿ç”¨ `init.sh` çš„éƒ¨ç½²

### çŠ¶æ€
- âœ… **å·²åˆ›å»ºä¿®å¤è„šæœ¬**: 2025-08-26
- âœ… **æ–‡æ¡£å·²æ›´æ–°**: éƒ¨ç½²æ¸…å•å’Œæ•°æ®åº“README
- âš ï¸ **è¡¨åæ ¼å¼é—®é¢˜**: manual-init.shä½¿ç”¨é”™è¯¯è¡¨åæ ¼å¼ï¼Œå·²ä¿®å¤

## ğŸ”§ æ•°æ®åº“è¡¨åæ ¼å¼é—®é¢˜

### é—®é¢˜æè¿°
manual-init.shè„šæœ¬ä¸­ä½¿ç”¨äº†PascalCaseè¡¨åæ ¼å¼ï¼ˆå¦‚"User", "Asset"ï¼‰ï¼Œä½†Prismaç”Ÿæˆçš„å®é™…è¡¨åæ˜¯snake_caseæ ¼å¼ï¼ˆå¦‚users, assetsï¼‰ã€‚

### æ ¹æœ¬åŸå› 
- âŒ **é”™è¯¯**: ä½¿ç”¨`"User"`ã€`"Asset"`ç­‰PascalCaseæ ¼å¼
- âœ… **æ­£ç¡®**: ä½¿ç”¨`users`ã€`assets`ç­‰snake_caseæ ¼å¼

### è§£å†³æ–¹æ¡ˆ
å·²ä¿®å¤manual-init.shä¸­æ‰€æœ‰SQLè¯­å¥çš„è¡¨åæ ¼å¼ï¼Œä½¿ç”¨æ­£ç¡®çš„snake_caseè¡¨åã€‚

### å½±å“
- æ‰‹åŠ¨SQLæ’å…¥å¤±è´¥ï¼Œä½†Prismaç§å­è„šæœ¬æ­£å¸¸å·¥ä½œ
- æ•°æ®åº“éªŒè¯æŸ¥è¯¢å¤±è´¥

### çŠ¶æ€
- âœ… **å·²ä¿®å¤**: 2025-08-26

## ğŸ“ æ›´æ–°è®°å½•
- **2025-08-26**: ä¿®å¤Redisé…ç½®é—®é¢˜ï¼Œæ›´æ–°éƒ¨ç½²æ–‡æ¡£
- **2025-08-26**: æ·»åŠ ç«¯å£å†²çªè‡ªåŠ¨æ£€æµ‹å’Œè§£å†³æ–¹æ¡ˆ
- **2025-08-26**: åˆ›å»ºå®Œæ•´çš„æ•°æ®åº“æ‰‹åŠ¨åˆå§‹åŒ–è„šæœ¬ï¼ŒåŒ…å«ä¸»æ•°æ®å’Œæµ‹è¯•æ•°æ®
- **2025-08-26**: ä¿®å¤æ•°æ®åº“è¡¨åæ ¼å¼é—®é¢˜ï¼ˆPascalCase â†’ snake_caseï¼‰

---
**ç»´æŠ¤è¯´æ˜**: é‡åˆ°æ–°é—®é¢˜æ—¶ï¼Œè¯·åŠæ—¶æ›´æ–°æ­¤æ–‡æ¡£