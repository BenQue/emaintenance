# E-Maintenance è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ¯ éƒ¨ç½²æ–¹æ¡ˆæ€»ç»“

ç»è¿‡æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬ç¡®å®šäº†ç»Ÿä¸€çš„è¿œç¨‹æœåŠ¡å™¨æ›´æ–°ç­–ç•¥ï¼š

### ğŸ“ ç›®å½•ç»“æ„è¯´æ˜
```
deploy/
â”œâ”€â”€ Server/              âœ… ç”Ÿäº§ç¯å¢ƒ (å½“å‰è¿œç¨‹æœåŠ¡å™¨ä½¿ç”¨)
â”‚   â”œâ”€â”€ update-modules.sh    # åˆ†æ¨¡å—æ›´æ–°è„šæœ¬
â”‚   â”œâ”€â”€ quick-update.sh      # å¿«é€Ÿæ›´æ–°å‘½ä»¤
â”‚   â”œâ”€â”€ status.sh           # çŠ¶æ€ç›‘æ§
â”‚   â””â”€â”€ rollback.sh         # å›æ»šè„šæœ¬
â”œâ”€â”€ modular/             ğŸš§ ä¸‹ä¸€ä»£æ¶æ„ (æœªæ¥è¿ç§»ç›®æ ‡)
â”‚   â””â”€â”€ ...             
â”œâ”€â”€ Local/               ğŸ’» æœ¬åœ°å¼€å‘
â”‚   â””â”€â”€ ...
â””â”€â”€ remote-update.sh     ğŸ†• ç»Ÿä¸€æ›´æ–°å…¥å£ (æ–°å»º)
```

### ğŸ”„ æ¨èéƒ¨ç½²æµç¨‹

#### 1ï¸âƒ£ ç«‹å³ä½¿ç”¨ - ç»Ÿä¸€æ›´æ–°è„šæœ¬

```bash
# åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /path/to/your/emaintenance/deploy
./remote-update.sh
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- ğŸ”„ è‡ªåŠ¨åŒæ­¥æœ€æ–°ä»£ç 
- ğŸ¯ æä¾›å¤šç§æ›´æ–°é€‰é¡¹
- âœ… å†…ç½®éƒ¨ç½²åéªŒè¯  
- ğŸ“Š è¯¦ç»†çš„çŠ¶æ€åé¦ˆ

#### 2ï¸âƒ£ æ›´æ–°é€‰é¡¹è¯´æ˜

| é€‰é¡¹ | é€‚ç”¨åœºæ™¯ | æ›´æ–°å†…å®¹ | æ¨èä½¿ç”¨ |
|------|----------|----------|----------|
| **å‰ç«¯æ›´æ–°** | UIä¿®å¤ã€æ ·å¼è°ƒæ•´ | Webåº”ç”¨ + Nginx | ğŸŸ¢ é«˜é¢‘ä½¿ç”¨ |
| **åç«¯æ›´æ–°** | APIä¿®å¤ã€ä¸šåŠ¡é€»è¾‘ | æ‰€æœ‰å¾®æœåŠ¡ | ğŸŸ¢ é«˜é¢‘ä½¿ç”¨ |
| **å…¨é‡æ›´æ–°** | å¤§ç‰ˆæœ¬å‡çº§ | æ‰€æœ‰åº”ç”¨æ¨¡å— | ğŸŸ¡ è°¨æ…ä½¿ç”¨ |
| **è‡ªå®šä¹‰æ›´æ–°** | ç‰¹å®šæ¨¡å—ä¿®å¤ | é€‰æ‹©æ€§æ›´æ–° | ğŸ”µ é«˜çº§ç”¨æˆ· |

#### 3ï¸âƒ£ å®‰å…¨æ›´æ–°å»ºè®®

**æ›´æ–°å‰ï¼š**
```bash
# 1. å¤‡ä»½å½“å‰é…ç½®
cp -r /path/to/emaintenance /backup/emaintenance-$(date +%Y%m%d)

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
cd /path/to/emaintenance/deploy/Server
./status.sh quick
```

**æ›´æ–°åï¼š**
```bash
# 1. éªŒè¯æœåŠ¡å¥åº·
./status.sh health

# 2. æ£€æŸ¥å…³é”®åŠŸèƒ½
curl http://localhost:3000/api/health
curl http://localhost:3001/health  # ç”¨æˆ·æœåŠ¡
curl http://localhost:3002/health  # å·¥å•æœåŠ¡
curl http://localhost:3003/health  # èµ„äº§æœåŠ¡
```

## ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—

### ç¬¬ä¸€æ¬¡éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨

```bash
# 1. ç™»å½•è¿œç¨‹æœåŠ¡å™¨
ssh user@your-server-ip

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/emaintenance/deploy

# 3. æ‰§è¡Œç»Ÿä¸€æ›´æ–°è„šæœ¬
./remote-update.sh

# 4. é€‰æ‹© "3) å…¨é‡æ›´æ–°æ‰€æœ‰æœåŠ¡"

# 5. ç­‰å¾…éƒ¨ç½²å®Œæˆå¹¶éªŒè¯
```

### æ—¥å¸¸æ›´æ–°æµç¨‹

```bash
# å‰ç«¯ä¿®å¤ (æœ€å¸¸ç”¨)
./remote-update.sh
# é€‰æ‹©é€‰é¡¹ 1

# åç«¯ä¿®å¤  
./remote-update.sh  
# é€‰æ‹©é€‰é¡¹ 2

# ç´§æ€¥å›æ»š
./remote-update.sh
# é€‰æ‹©é€‰é¡¹ 6
```

## âš¡ é«˜çº§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šç´§æ€¥çƒ­ä¿®å¤
```bash
# 1. å¿«é€Ÿä¿®å¤å•ä¸ªæœåŠ¡
cd deploy/Server
./quick-update.sh workorder  # ä¿®å¤å·¥å•æœåŠ¡

# 2. ç«‹å³éªŒè¯
./status.sh health
```

### åœºæ™¯2ï¼šåˆ†æ‰¹æ›´æ–°
```bash
# 1. å…ˆæ›´æ–°ä¸å½±å“ç”¨æˆ·çš„æœåŠ¡
./quick-update.sh asset

# 2. éªŒè¯æ— é—®é¢˜åæ›´æ–°æ ¸å¿ƒæœåŠ¡  
./quick-update.sh workorder
./quick-update.sh user
```

### åœºæ™¯3ï¼šç‰ˆæœ¬å›æ»š
```bash
# 1. å¯åŠ¨å›æ»šå‘å¯¼
cd deploy/Server
./rollback.sh

# 2. é€‰æ‹©å›æ»šç›®æ ‡ç‰ˆæœ¬
# 3. ç¡®è®¤å›æ»šæ“ä½œ
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜è§£å†³

**é—®é¢˜1ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥**
```bash
# æŸ¥çœ‹å…·ä½“é”™è¯¯
docker-compose -f deploy/Server/docker-compose.yml logs [service-name]

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose -f deploy/Server/docker-compose.yml restart [service-name]
```

**é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker-compose -f deploy/Server/docker-compose.yml ps postgres

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker exec -it emaintenance-postgres psql -U postgres -d emaintenance
```

**é—®é¢˜3ï¼šNginxé…ç½®é”™è¯¯**
```bash
# éªŒè¯nginxé…ç½®
docker exec -it emaintenance-nginx nginx -t

# é‡æ–°åŠ è½½nginxé…ç½®
docker exec -it emaintenance-nginx nginx -s reload
```

### ç›‘æ§å’Œæ—¥å¿—

```bash
# å®æ—¶ç›‘æ§æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose -f deploy/Server/docker-compose.yml logs -f

# ç›‘æ§ç‰¹å®šæœåŠ¡
docker-compose -f deploy/Server/docker-compose.yml logs -f web

# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
docker stats $(docker-compose -f deploy/Server/docker-compose.yml ps -q)
```

## ğŸ“‹ éƒ¨ç½²æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] æœåŠ¡å™¨ç£ç›˜ç©ºé—´å……è¶³ (è‡³å°‘5GBå¯ç”¨)
- [ ] Dockerå’ŒDocker Composeå·²å®‰è£…å¹¶è¿è¡Œ
- [ ] ç½‘ç»œè¿æ¥ç¨³å®š
- [ ] æ•°æ®åº“å·²å¤‡ä»½
- [ ] ç¡®è®¤æ›´æ–°çš„ä»£ç å·²æäº¤åˆ°mainåˆ†æ”¯

### éƒ¨ç½²åéªŒè¯  
- [ ] æ‰€æœ‰å®¹å™¨çŠ¶æ€ä¸ºå¥åº· (healthy)
- [ ] Webåº”ç”¨å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] APIå¥åº·æ£€æŸ¥ç«¯ç‚¹å“åº”æ­£å¸¸
- [ ] ç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•å’Œä½¿ç”¨æ ¸å¿ƒåŠŸèƒ½
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸ï¼Œæ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡

### å›æ»šå‡†å¤‡
- [ ] è®°å½•å½“å‰ç‰ˆæœ¬çš„Git commit hash
- [ ] ä¿å­˜å½“å‰çš„ç¯å¢ƒå˜é‡é…ç½®
- [ ] ç¡®è®¤å›æ»šè„šæœ¬å¯ç”¨
- [ ] å‡†å¤‡ç´§æ€¥è”ç³»æ–¹å¼

## ğŸ”® æœªæ¥è¿ç§»è®¡åˆ’

**çŸ­æœŸç›®æ ‡ (1-2ä¸ªæœˆ)ï¼š**
- ç»§ç»­ä¼˜åŒ–Serveræ–¹æ¡ˆçš„è„šæœ¬å’Œç›‘æ§
- å®Œå–„è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²éªŒè¯
- å»ºç«‹å®Œæ•´çš„å¤‡ä»½å’Œæ¢å¤æµç¨‹

**ä¸­æœŸç›®æ ‡ (3-6ä¸ªæœˆ)ï¼š**
- é€æ­¥è¿ç§»åˆ°modularæ¶æ„
- å¼•å…¥å®¹å™¨ç¼–æ’ (Kubernetes/Docker Swarm)
- å®ç°è“ç»¿éƒ¨ç½²å’Œé‡‘ä¸é›€å‘å¸ƒ

**é•¿æœŸç›®æ ‡ (6ä¸ªæœˆ+)ï¼š**
- å®Œæ•´çš„DevOpsæµæ°´çº¿
- è‡ªåŠ¨åŒ–ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ
- å¤šç¯å¢ƒç®¡ç† (dev/test/staging/prod)

---

## ğŸ†˜ ç´§æ€¥è”ç³»

å¦‚é‡åˆ°ä¸¥é‡é—®é¢˜æ— æ³•è§£å†³ï¼š

1. **ç«‹å³å›æ»š**ï¼š`cd deploy/Server && ./rollback.sh`
2. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**ï¼š`./status.sh`  
3. **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**ï¼š`docker-compose logs -f`
4. **è”ç³»æŠ€æœ¯æ”¯æŒ**ï¼šè®°å½•é”™è¯¯ä¿¡æ¯å’Œæ“ä½œæ­¥éª¤

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€